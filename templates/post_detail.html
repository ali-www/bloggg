{% extends 'base.html' %}


{% block body %}
<style>
  @import url('https://fonts.googleapis.com/icon?family=Material+Icons');
</style>
<div class="container">

  <div class="row">

    <div class="col-12">
      <h2 class="text-center text-uppercase shadow p-3 mb-5 bg-white rounded">{{posts.title}}</h2>
      <div class="shadow p-3 mb-5 bg-white rounded">
        <!--============================================================ start video -->
        <video style="width:100%" controls>
          <source src="{{posts.video.url}}" type="video/mp4">
          <source src="mov_bbb.ogg" type="video/ogg">

        </video>
        <!--============================================================ end video -->

        <p>{{posts.body}}</p>
        <!---============================================================= start like =======-->
        Like :
        <span class="" id="like_count"> {{posts.like_count}}</span>
        <button class="btn btn-link text-dark p-0 border-0 btn-outline-light" id="like-button" value="{{posts.id}}">
          {% csrf_token %}
          <i class="material-icons" style="font-size:48px;color:red">favorite</i>
        </button>
        <!--================================================================ end like =====-->
        <small> Views Count ({{posts.post_views}})</small>
        <p class="text-muted"> The author : {{posts.author}}</p>
        <p class="text-muted">{{posts.date}}</p>
      </div>
    </div>

  </div>
  <!--==========================================================================================  start comment -->
  <div class="row comment-wrapper">
    {% for comment in comments %}
    <div class="col-12 ">
      <small>{{comment.user}}</small>
      <div class="mb-3">
        {{comment.body}}
      </div>
    </div>
    {% endfor %}
  </div>
  <!--========================================================================================= end comment -->
  <!--========================================================================================= start comment form -->
  <div class="row">
    <div class="col-12">

      <textarea class="form-control comment-text " data-action='mark'></textarea>
      <div class="d-grid gap-2">
        <button type="button " data-posts="{{posts.id}}" class="btn btn-dark my-3 save-comment">Add Comment </button>
      </div>

    </div>
  </div>
  <!--========================================================================================= end comment form -->


</div>

{% endblock %}

{% block scripts %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
<script>
  var j = $.noConflict();
  j(document).on('click', '#like-button', function (e) {
    console.log('ok')
    e.preventDefault()
    j.ajax({
      url: "{% url 'blog:like' %}",
      type: 'POST',
      dataType: 'JSON',
      data: {
        action: 'post',
        postid: j('#like-button').val(),
        csrfmiddlewaretoken: j('input[name=csrfmiddlewaretoken]').val(),
      },
      success: function (data) {
        document.getElementById('like_count').innerHTML = data['result']
      },
      error: function (xhr, errmsg, err) { }


    })
  });
  //==================================================================================

  j('.save-comment').on('click', function (e) {
    e.preventDefault();
    var _comment = j('.comment-text').val();
    var postsid = j(this).data('posts');
    j.ajax({
      url: '/save-comment',
      type: 'POST',
      data: {
        comment: _comment,
        postsid: postsid,
        csrfmiddlewaretoken: '{{csrf_token}}'
      },
      dataType: 'json',
      beforeSend: function () {
        j(".save-comment").addClass('disabled').text('saving...');
      },
      success: function (res) {
        if (res.bool == true) {
          j('.comment-text').val('');
          var _html = ' <div class="col-12 animate__animated animate__bounce">\
                        <small>{{request.user}}</small>\
                        <div class="">\
                          '+ _comment + '\
                        </div>\
                      </div>';
          j('.comment-wrapper').append(_html);
        }

        j(".save-comment").removeClass('disabled').text('Submit');

      }

    })




  })


</script>
{% endblock %}